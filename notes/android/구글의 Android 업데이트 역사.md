## 구글의 Android 업데이트 역사

Android Weekly #689 **Project Mainline: How Google Reshaped Android Updates**를 정리하며 작성하는 글이다.

### 안드로이드의 업데이트 반영 기간?
안드로이드는 세계에서 가장 인기있는 OS로, 매년 구글은 새로운 안드로이드 업데이트를 릴리즈한다.  

하지만, 오직 Pixel (구글의 스마트폰)만이 업데이트가 즉시 반영되고, 
삼성과 같은 타 공급업체에서 OS 업데이트를 반영하는 것은 적어도 약 3개월이 걸린다.  

10년 전에는, 이 기간이 약 9~12개월이 걸리곤 했고, 중급 혹은 저가형 기기는 아예 업데이트를 반영하지 않기도 했다.  

안드로이드도 애플처럼 모든 지원 기기에 업데이트를 동시 반영하는 날이 올까? 
그동안 안드로이드는 어떻게 업데이트 지연을 줄였을까?

### 초기의 안드로이드
- 초기의 Google은 구글만의 하드웨어를 개발하는 것 보다 **OS를 개발해 제조사에 서비스하는 포지션에 집중**했다.
- 제조사는 그 Android 베이스를 가져다 커스터마이즈하여 사용했다.
  - 기본 어플을 교체하고
  - 디자인을 변경했으며
  - 사업체의 특징을 추가했다.
  - 그리고 종종 Android의 주요 매커니즘을 수정하기도 했다.
- 이런 특징으로 Android는 빠르게 퍼졌지만, _*단편화_ 를 초래하여 시장엔 서로 다른 버전과 커스텀된 OS를 가진 기기들이 넘쳐났다.

_*단편화: 하나의 시장이 여러개의 작고 특화된 틈새시장으로 쪼개지는 현상_

### 왜 업데이트가 오래걸렸을까?
제조사들이 새로운 안드로이드 버전을 받아 그걸 반영하기까지 6~18개월이 걸렸다. 왜 그럴 수 밖에 없었을까?

**[1] 단일 구조**  

안드로이드는 과거에 하나의 크고 강하게 결합된 시스템으로 디자인되었다.
따라서, 제조사들은 이를 업데이트 하기 위해
  1. 안정된 OS 버전 릴리즈를 기다리고,
  3. 제조사들만의 수정사항 및 특징을 새로운 OS에 적용해야한다.
  4. 마지막으로 이를 기기별로 테스트를 진행,
  5. 펌웨어를 배포해야한다. (사용자에게 업데이트를 제공)

이 과정은 복잡하고 돈이 많이 들며, 에러가 잦았다.

**[2] 하드웨어 시장**

안드로이드는 앱 판매, 구독, 서비스로부터 수익을 얻지만
대부분의 스마트폰 제조사는 기기 판매와 기기에 기본으로 설치한 앱을 통해 수익을 얻는다.

따라서, 스마트폰 제조사는 오래된 모델을 빠르게 업데이트하여 얻는 이득이 적다. 

**[3] 모듈화 부족**

안드로이드가 모듈화되지 않아 상인들은 업데이트를 점진적으로 진행할 방법이 없었다. 
펌웨어 배포를 위해 전체를 확인해야했고, 이는 업데이트를 지연시켰다.
 
### 구글의 대응 1 - Project Treble
2017년, 구글은 Android 8 (오레오)와 함께 **Project Treble** 을 소개했다.
이를 통해 안드로이드 OS 프레임워크와 제조사 기기를 분리하여 관리할 수 있었다.

<img width="1280" height="964" alt="image" src="https://github.com/user-attachments/assets/b184fd20-d272-4ce5-91cb-538de7e3c305" />

좀 더 자세하게 설명하자면, 예전에는 제조사의 하드웨어(카메라, 오디오, 센서 등)와 그 하드웨어를 구동하는 드라이버
그리고 안드로이드의 앱, 화면 전환, 알림들을 관리하는 상위 OS 부분이 깊게 얽혀있었던데에 반해, 
**Project Treble**은 이 둘을 분리하고 연결하는 통로(인터페이스)를 도입했다는 것이다.  

예를 들어, 이전에 OS에서 카메라를 구동하려면 프레임워크가 내부적으로 _*HAL_ 라이브러리를 직접 불러 하드웨어 드라이버와 통신해야 했지만, 
Treble은 '카메라 구동' 이라는 동작을 인터페이스로 정의하고, 제조사는 그 인터페이스를 구현한 HAL을 제공, 
Android는 카메라를 사용할 때 이 인터페이스를 호출하는 식으로 프레임워크와 드라이버가 분리되었던 것이다. (안드로이드는 HAL에 대해 직접 알 필요가 없어졌다.)  

_*HAL: Hardware Abstraction Layer(하드웨어 추상화 계층) 으로 안드로이드 프레임워크가 이해할 수 있는 공통 언어로 하드웨어 기능을 바꿔주는 번역기_

이를 통해 Android OS가 업데이트가 되어도 인터페이스는 그대로 유지되므로 제조사는 코드를 수정할 필요가 줄어들었다.

### 구글의 대응 2 - 모듈화
Android 10, 구글은 새로운 아키텍쳐인 **Product Mainline**을 소개한다. OS는 독립적으로 업데이트될 수 있는 모듈로 분리되는데, 
초기에는 9개였던 모듈이, Android 16에 들어서 50개가 넘는 모듈로 분리되었다.  

OS 전체에 대한 펌웨어 업데이트에 의존하는 대신, 구글은 이제 중요한 컴포넌트를 Google Play를 통해 직접적으로 사용자에게 전달할 수 있게 되었다. 
좀 더 자세하게, 이전에 제조사/통신사의 테스트를 거치고 서버로 사용자에게 전달되었던 업데이트와 달리, 
Mainline은 플레이 스토어를 매개체로, 몇몇 주요 업데이트를 백그라운드로 다운로드 및 설치할 수 있다.

이는 하나의 전환점이 되었다. 처음으로 구글이 제조사를 거치지 않고 **업데이트를 독립적으로 배포**할 수 있었다.  

### 모듈이 전달되는 방식 - APK vs APEX
Mainline의 모듈은 두 가지 포맷이 있다.
1. APK 모듈
일반적인 앱 업데이트처럼 배포되며, 재부팅 없이 런타임동안 기기에 자동으로 설치된다.
2. APEX 모듈
OS 핵심 라이브러리와 저수준의 컴포넌트를 위한 컨테이너이며, 이는 시스템이 작동하는 동안 업데이트될 수 없어 재부팅이 필요하다.

구글은 여기에 더해 **Direct Boot**와 자동 리부트 메커니즘을 구축해 APEK가 사용자를 방해하지 않고 매끄럽게 업데이트 될 수 있도록 했다.  

물론 Mainline으로 OS 버전 전체를 업데이트할 수 있는 것은 아니다. (Android 11 -> 12 는 불가능)
APK, APEX는 OS의 일부 기능(보안, 라이브러리 등)만 최신 상태로 유지할 수 있도록 돕는 모듈이다.

### 오래된 OS 기기에서 최신 API를 사용하는 방법 - SDK Extensions
구버전 Android 기기에서도 최신 API를 사용할 수 있도록, 구글은 SDK Extensions을 도입했다. 
개발자는 이를 활용해 앱에서 최신 기능을 구현할 수 있으며, 
구글은 해당 기능을 Mainline 모듈 형태로 배포하여 사용자 기기에 자동으로 전달한다.

예를 들어, Photo Picker API는 안드로이드 13에서 도입되었지만, SDK Extensions으로 같은 기능을 Android 11과 12에서도 사용할 수 있다.

## 출처
- 🧩 [Project Mainline: How Google Reshaped Android Updates](https://proandroiddev.com/project-mainline-31151e235d7a)

